# Atlas Database Patch Plan

**Generated:** 2026-01-28T00:41:17.182Z

This document outlines SQL patches and manual steps to resolve audit findings.

**⚠️ IMPORTANT: Review all patches before executing. Back up database first.**

## REIT CIK Updates
```sql
UPDATE companies SET sec_cik = '0000810765', sec_ticker = 'NHC' WHERE id = 14615;
```

---

## Nonprofit EIN Updates
```sql
UPDATE companies SET ein = '39-1613624' WHERE id = 14; -- Ascension Living
UPDATE companies SET ein = '71-0236856' WHERE id = 13792; -- Baptist Health
UPDATE companies SET ein = '25-1189696' WHERE id = 15275; -- Presbyterian Senior Care
UPDATE companies SET ein = '93-0863097' WHERE id = 244; -- Providence Health
UPDATE companies SET ein = '38-2113393' WHERE id = 38; -- Trinity Health
UPDATE companies SET ein = '46-0422673' WHERE id = 71; -- Avera Health
UPDATE companies SET ein = '62-1646734' WHERE id = 22; -- Covenant Health
-- Research EIN for company ID 14628: GENESIS HEALTHCARE
-- Research EIN for company ID 10: SABER HEALTHCARE GROUP
-- Research EIN for company ID 15280: The Evangelical Lutheran Good Samaritan Society
-- Research EIN for company ID 221: INFINITY HEALTHCARE CONSULTING
-- Research EIN for company ID 358: LEGACY HEALTHCARE
-- Research EIN for company ID 94: CREATIVE SOLUTIONS IN HEALTHCARE
-- Research EIN for company ID 39: CIENA HEALTHCARE/LAUREL HEALTH CARE
-- Research EIN for company ID 454: CASCADIA HEALTHCARE
-- Research EIN for company ID 14646: Autumn Lake Healthcare
-- Research EIN for company ID 152: FUNDAMENTAL HEALTHCARE
-- Research EIN for company ID 280: SIGNATURE HEALTHCARE
-- Research EIN for company ID 139: NATIONAL HEALTHCARE CORPORATION
-- Research EIN for company ID 452: NORTH SHORE HEALTHCARE
-- Research EIN for company ID 95: SOVEREIGN HEALTHCARE HOLDINGS
-- Research EIN for company ID 476: EMERALD HEALTHCARE
```

---

## Inflated Principal Review

Principals with >500 properties likely have incorrect company assignments.
Review these principals and their company relationships:

See: `INFLATED_PRINCIPALS.csv`

Typical resolution: Verify the principal is actually associated with the parent company,
not incorrectly linked to all subsidiaries.

---

## Verification Queries

After applying patches, run these queries to verify:

### Referential Integrity
```sql
-- Should return 0 for all
SELECT 'entities_without_company', COUNT(*) FROM entities e LEFT JOIN companies c ON c.id = e.company_id WHERE c.id IS NULL
UNION ALL
SELECT 'per_invalid_property', COUNT(*) FROM property_entity_relationships per LEFT JOIN property_master pm ON pm.id = per.property_master_id WHERE pm.id IS NULL
UNION ALL
SELECT 'per_invalid_entity', COUNT(*) FROM property_entity_relationships per LEFT JOIN entities e ON e.id = per.entity_id WHERE e.id IS NULL;
```

### Operator Uniqueness
```sql
-- Should return 0
SELECT COUNT(*) FROM (
  SELECT property_master_id FROM property_entity_relationships
  WHERE relationship_type = 'facility_operator' AND end_date IS NULL
  GROUP BY property_master_id HAVING COUNT(*) > 1
) x;
```

### Principal Sanity
```sql
-- Should return 0
SELECT COUNT(*) FROM (
  SELECT p.id FROM principals p
  JOIN principal_company_relationships pcr ON pcr.principal_id = p.id
  JOIN companies c ON c.id = pcr.company_id
  JOIN entities e ON e.company_id = c.id
  JOIN property_entity_relationships per ON per.entity_id = e.id
  JOIN property_master pm ON pm.id = per.property_master_id
  WHERE pcr.end_date IS NULL AND per.end_date IS NULL
  GROUP BY p.id HAVING COUNT(DISTINCT pm.id) > 500
) x;
```

---

*Patch plan generated by Atlas Database Validation Audit*
